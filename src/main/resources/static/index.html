<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>校园闲品 - 首页</title>
    <style>
        body { margin: 0; font-family: Arial; background: #f7f7f7; }

        /* 返回按钮 */
        .back-btn {
            padding: 10px;
            background: #f5f5f5;
            cursor: pointer;
        }

        /* 搜索框 */
        .search-bar {
            padding: 15px;
            background: white;
        }
        .search-input {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 25px;
            padding: 12px 18px;
            background: #f1f1f1;
            font-size: 16px;
        }

        /* 商品卡片 */
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }
        .product-card img {
           width: 150px;       /* 控制宽度 */
           height: 100px;      /* 控制高度 */
           object-fit: cover;  /* 裁剪并填充图片 */
           border-radius: 10px;
        }
        .product-title { font-size: 16px; margin: 5px 0 3px; }
        .product-price { color: #ff5722; font-weight: bold; }

        /* 底部导航栏 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 55px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .nav-item { text-align: center; font-size: 14px; color: #444; text-decoration: none; }
    </style>
</head>
<body>

<!-- 返回按钮 -->
<div class="back-btn" onclick="goBackLogin()">← 返回登录</div>

<!-- 搜索框 -->
<div class="search-bar">
   <input id="search-input" class="search-input" 
       placeholder="搜索商品、关键字" 
       onkeydown="if(event.key==='Enter') searchProduct()">
</div>

<h2 style="padding:10px;">推荐商品</h2>

<div id="recommend-container"></div>

<script>
async function loadRandomProducts() {
    const res = await fetch("/products/randomtwo");
    const products = await res.json();

    const container = document.getElementById("recommend-container");
    container.innerHTML = ""; // 清空旧内容

    products.forEach(p => {
        const card = document.createElement("div");
        card.className = "product-card";

        let imgSrc = (p.images && p.images.length > 0) ? p.images[0] : "/images/default.jpg";

        card.innerHTML = `
            <img src="${imgSrc}" alt="商品图片">
            <div class="product-title">${p.title}</div>
            <div class="product-price">￥${p.price}</div>
        `;

        card.onclick = () => {
            window.location.href = "/product_detail.html?id=" + p.id;
        };

        container.appendChild(card);
    });
}

loadRandomProducts();
</script>

<!-- 底部导航栏 -->
<div class="bottom-nav">
    <a class="nav-item" href="/index.html">首页</a>
    <a class="nav-item" href="/publish.html">发布</a>
    <a class="nav-item" href="/messages.html">消息</a>
    <a class="nav-item" href="/mine.html">我的</a>
</div>

<script>
function goBackLogin() {
    window.location.href = "/login.html";  // 跳转回登录页
}
</script>

<script>
async function searchProduct() {
    let keyword = document.getElementById("search-input").value.trim();
    if (!keyword) return;

    const res = await fetch(`/products/search?title=` + encodeURIComponent(keyword));
    const list = await res.json();

    if (list.length === 0) {
        alert("未找到相关商品");
        return;
    }

    // 只有一个商品 → 直接跳详情页
    if (list.length === 1) {
        window.location.href = "/product_detail.html?id=" + list[0].id;
        return;
    }

    // 多个商品 → 跳到搜索结果页
    localStorage.setItem("searchResults", JSON.stringify(list));
    window.location.href = "/search_result.html";
}
</script>

</body>
</html>
