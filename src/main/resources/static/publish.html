<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>发布商品</title>

    <style>
        body { margin: 0; background: #f5f5f5; font-family: Arial; }

        .header {
            padding: 20px;
            background: white;
            font-size: 22px;
            font-weight: bold;
            border-bottom: 1px solid #eee;
        }

        .container {
            padding: 15px;
        }

        .input-group {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .input-group label {
            font-size: 16px;
            color: #444;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            margin-top: 8px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        textarea {
            resize: none;
            height: 100px;
        }

        .image-upload-box {
            width: 100%;
            height: 120px;
            background: white;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            flex-direction: column;
            cursor: pointer;
        }

        .image-upload-box img {
            height: 80px;
            opacity: 0.3;
        }

        .publish-btn {
            width: 90%;
            margin: 20px auto;
            display: block;
            padding: 14px;
            background: #4caf50;
            color: white;
            border: none;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 55px;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .nav-item {
            text-align: center;
            font-size: 14px;
            color: #444;
            text-decoration: none;
        }
    </style>
</head>

<body>

<div class="header">发布商品</div>

<div class="container">

    <!-- 上传图片区域 -->
    <div class="image-upload-box" onclick="selectImage()">
        <img src="https://cdn-icons-png.flaticon.com/512/1829/1829586.png">
        <p style="color:#888;">点击上传商品图片</p>
    </div>
    <input type="file" id="imageFile" accept="image/*" style="display:none">

    <!-- 商品标题 -->
    <div class="input-group">
        <label>商品标题</label>
        <input type="text" id="title" placeholder="例如：九成新计算机教材">
    </div>

    <!-- 商品描述 -->
    <div class="input-group">
        <label>商品描述</label>
        <textarea id="desc" placeholder="简单介绍一下商品情况..."></textarea>
    </div>

    <!-- 价格 -->
    <div class="input-group">
        <label>价格（元）</label>
        <input type="number" id="price" placeholder="请输入价格">
    </div>

    <!-- 商品类别 -->
    <div class="input-group">
        <label>商品类别</label>
        <select id="category">
            <option value="">请选择类别</option>
            <option value="电子产品">电子产品</option>
            <option value="教材书籍">教材书籍</option>
            <option value="生活用品">生活用品</option>
            <option value="数码配件">数码配件</option>
            <option value="运动健身">运动健身</option>
            <option value="其他">其他</option>
        </select>
    </div>

</div>

<button class="publish-btn" onclick="publishProduct()">确认发布</button>

<div class="bottom-nav">
    <a class="nav-item" href="/index.html">首页</a>
    <a class="nav-item" href="/publish.html">发布</a>
    <a class="nav-item" href="/messages.html">消息</a>
    <a class="nav-item" href="/mine.html">我的</a>
</div>

<script>

function selectImage() {
    document.getElementById("imageFile").click();
}

function publishProduct() {
    const user = JSON.parse(localStorage.getItem("user") || "{}");

    if (!user.username) {
        alert("请先登录！");
        window.location.href = "/login.html";
        return;
    }

    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("desc").value.trim();
    const price = document.getElementById("price").value.trim();
    const category = document.getElementById("category").value.trim();

    if (!title || !description || !price || !category) {
        alert("请填写所有信息！");
        return;
    }

    fetch("products/api/publish", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `title=${title}&description=${description}&price=${price}&category=${category}&username=${user.username}`
    })
    .then(r => r.json())
    .then(res => {
        if (res.success) {
            alert("发布成功！");
            window.location.href = "/mine.html";
        } else {
            alert("发布失败：" + res.msg);
        }
    });
}
</script>

</body>
</html>
