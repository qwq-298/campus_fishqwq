<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>消息</title>
<style>
body { margin: 0; font-family: Arial; background: #f5f5f5; }
.header { padding: 20px; background: white; font-size: 22px; font-weight: bold; border-bottom: 1px solid #eee; }
.messages-container { margin: 15px; padding: 0 10px; }
.message { background: white; padding: 12px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
.message-time { color: #888; font-size: 12px; margin-bottom: 5px; }
.bottom-nav { position: fixed; bottom: 0; width: 100%; height: 55px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; }
.nav-item { text-align: center; font-size: 14px; color: #444; text-decoration: none; }
</style>
</head>
<body>

<div class="header">消息</div>
<div class="messages-container" id="messages">
    <p>加载中...</p>
</div>

<div class="bottom-nav">
    <a class="nav-item" href="/index.html">首页</a>
    <a class="nav-item" href="/publish.html">发布</a>
    <a class="nav-item" href="/messages.html">消息</a>
    <a class="nav-item" href="/mine.html">我的</a>
</div>

<script>
window.onload = async function() {
    const user = JSON.parse(localStorage.getItem("user") || "{}");
    if (!user.username || !user.id) {
        alert("请先登录");
        window.location.href = "/login.html";
        return;
    }

    const res = await fetch(`/products/show/${user.id}`);
    const products = await res.json();

    const container = document.getElementById("messages");
    container.innerHTML = "";

    if (!products || products.length === 0) {
        container.innerHTML = "<p>你还没有发布过商品</p>";
        return;
    }

    // 按发布时间倒序显示（最近发布在前）
    const sortedProducts = products.sort((a, b) => new Date(b.publishTime) - new Date(a.publishTime));

    sortedProducts.forEach(p => {
        const msg = document.createElement("div");
        msg.className = "message";

        const timeStr = new Date(p.publishTime).toLocaleString(); // 格式化时间
        msg.innerHTML = `
            <div class="message-time">${timeStr}</div>
            <div>你发布了商品 <strong>${p.title}</strong></div>
        `;

        container.appendChild(msg);
    });
};
</script>

</body>
</html>
